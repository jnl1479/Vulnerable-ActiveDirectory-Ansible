1. Vulnerability Overview
    Name/Type: AS-REP Roasting & Insecure Account Configuration (No Password Required).

    CVE: N/A (Feature-based misconfiguration).

    Severity: Critical.

    Impact: Complete domain takeover. An attacker gains initial access without a password and pivots to a high-privileged executive account, allowing them to extract sensitive domain credentials.

    Attack Vector: An attacker identifies accounts that do not require Kerberos pre-authentication. By requesting an authentication ticket, they receive an encrypted blob that can be cracked offline to reveal the plaintext password.

2. Exploitation Steps
    Phase A: Reconnaissance & Initial Access (rbartmoss)
        Discovery: The attacker scans the domain for accounts with the PASSWD_NOTREQD flag.

        Tool: PowerView.ps1

        Command: Get-DomainUser -Property sAMAccountName, useraccountcontrol | Where-Object {$_.useraccountcontrol -band 32}

        Exploitation:

        Attempt an interactive login or SMB connection to a workstation using the username rbartmoss.

        When prompted for a password, leave the field blank and press Enter.

        Result: Successful authentication as a domain user.

    Phase B: Lateral Movement & Pivot (The Hint)
        Discovery: Once logged in as rbartmoss, the attacker enumerates the directory to find a path to the AS-REP roasting user.

        Command: Get-ADUser rbartmoss -Properties Description

        Findings: The description reads: "LOG: Connected to Arasaka_Sync_Node. Legacy tunnel active for UID: sarasaka. Do not reset pre-auth flag."

    Phase C: AS-REP Roasting (sarasaka)
        Reconnaissance: Following the hint, the attacker checks sarasaka for the DONT_REQ_PREAUTH flag.

        Tool: Impacket (GetNPUsers.py)

        Command: python3 GetNPUsers.py arasaka.local/ -usersfile users.txt -no-pass

        Exploitation:

        Request Hash: The tool requests a TGT for sarasaka. Because pre-auth is disabled, the DC returns an encrypted AS-REP.

        Offline Cracking:

        Tool: Hashcat

        Command: hashcat -m 18200 sarasaka_hash.txt rockyou.txt

        Result: Password cracked: Arasaka2077!

3. Defensive Considerations
    Detection (Blue Team)
    Event ID 4768: Look for Kerberos Authentication Ticket (TGT) requests where "Pre-authentication Type" is 0 (None).

    Behavioral Indicators: Frequent failed login attempts (Event ID 4771) followed by a sudden successful login from a non-standard IP address.

    Tool Signatures: Detect the presence of Rubeus or Impacket in memory or command line logs (Sysmon Event ID 1).

    Mitigation
    Disable No-Preauth: Enforce "Account requires Kerberos preauthentication" for all users, especially high-privileged accounts like sarasaka.

    Enforce Password Complexity: Ensure the PASSWD_NOTREQD flag is never set via Group Policy (Default Domain Policy).

    Monitor UAC Changes: Alert on any modification to the userAccountControl attribute of administrative or executive users.